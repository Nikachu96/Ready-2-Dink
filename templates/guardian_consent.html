{% extends "base.html" %}

{% block title %}Parental Consent Authorization Form - Ready 2 Dink{% endblock %}

{% block content %}
<div class="row justify-content-center animate-in">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header text-white" style="background: linear-gradient(135deg, #3F567F 0%, #D174D2 100%); border: none;">
                <div class="text-center">
                    <h4 class="card-title mb-0 fw-bold">Parental Consent Authorization Form</h4>
                    <h5 class="mb-0 opacity-90">For Children Under 13 – Ready 2 Dink</h5>
                    <p class="mb-0 opacity-80 mt-2 small">
                        In compliance with the Children's Online Privacy Protection Act (COPPA), parental consent is required 
                        before a child under 13 can use Ready 2 Dink.
                    </p>
                </div>
            </div>
            <div class="card-body">
                <!-- Child Information Section -->
                <div class="card mb-4" style="border-left: 4px solid #3F567F;">
                    <div class="card-header bg-light">
                        <h6 class="mb-0"><i class="fas fa-child me-2"></i><strong>Child Information</strong></h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Child's Full Name:</strong> {{ player.full_name }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Child's Date of Birth:</strong> {{ player.dob }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Parent/Guardian Information Section -->
                <div class="card mb-4" style="border-left: 4px solid #0066cc;">
                    <div class="card-header bg-light">
                        <h6 class="mb-0"><i class="fas fa-user-tie me-2"></i><strong>Parent/Guardian Information</strong></h6>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('submit_guardian_consent', player_id=player.id) }}" id="consentForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="guardian_name" class="form-label">Parent/Guardian Full Name: *</label>
                                        <input type="text" class="form-control" id="guardian_name" name="guardian_name" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="relationship" class="form-label">Relationship to Child: *</label>
                                        <select class="form-select" id="relationship" name="relationship" required>
                                            <option value="">Select relationship</option>
                                            <option value="Parent">Parent</option>
                                            <option value="Legal Guardian">Legal Guardian</option>
                                            <option value="Grandparent">Grandparent</option>
                                            <option value="Other Legal Guardian">Other Legal Guardian</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="guardian_email" class="form-label">Email Address: *</label>
                                        <input type="email" class="form-control" id="guardian_email" name="guardian_email" 
                                               value="{{ player.guardian_email }}" readonly>
                                        <div class="form-text">This email was provided during registration</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="phone_number" class="form-label">Phone Number: *</label>
                                        <input type="tel" class="form-control" id="phone_number" name="phone_number" 
                                               placeholder="(555) 123-4567" required>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>

                <!-- Information We Collect Section -->
                <div class="card mb-4" style="border-left: 4px solid #ffc107;">
                    <div class="card-header bg-warning bg-opacity-25">
                        <h6 class="mb-0"><i class="fas fa-database me-2"></i><strong>Information We Collect</strong></h6>
                    </div>
                    <div class="card-body">
                        <p>By authorizing your child's account, you acknowledge that Ready 2 Dink will collect:</p>
                        <ul>
                            <li>Profile photo (selfie)</li>
                            <li>Date of birth</li>
                            <li>Preferred play locations</li>
                            <li>Match results, tournament participation, and skill ratings</li>
                        </ul>
                        <p><strong>This information is used only to:</strong></p>
                        <ul>
                            <li>Connect players by skill level and location</li>
                            <li>Organize tournaments and track results</li>
                            <li>Maintain a safe and fair community</li>
                        </ul>
                        <div class="alert alert-warning">
                            <strong>Privacy Protection:</strong> We do not sell or share your child's personal information with third parties for marketing.
                        </div>
                    </div>
                </div>

                <!-- Parent/Guardian Rights Section -->
                <div class="card mb-4" style="border-left: 4px solid #007bff;">
                    <div class="card-header bg-primary bg-opacity-25">
                        <h6 class="mb-0"><i class="fas fa-user-shield me-2"></i><strong>Parent/Guardian Rights</strong></h6>
                    </div>
                    <div class="card-body">
                        <p>As the parent/guardian, you have the right to:</p>
                        <ul>
                            <li>Review the information we collect from your child</li>
                            <li>Request deletion of your child's data</li>
                            <li>Withdraw consent and terminate your child's account at any time</li>
                        </ul>
                        <p>Requests can be made by emailing <a href="mailto:support@ready2dink.com">support@ready2dink.com</a></p>
                    </div>
                </div>

                <!-- Authorization Section -->
                <div class="card mb-4" style="border-left: 4px solid #28a745;">
                    <div class="card-header bg-success bg-opacity-25">
                        <h6 class="mb-0"><i class="fas fa-check-circle me-2"></i><strong>Authorization</strong></h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="consent_yes" name="consent_given" value="yes" required>
                                    <label class="form-check-label fw-bold text-success" for="consent_yes">
                                        <i class="fas fa-check me-2"></i>☑ I Consent
                                    </label>
                                    <div class="ms-4 mt-1">
                                        <small class="text-muted">I authorize my child to create and use a Ready 2 Dink account.</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="consent_no" name="consent_given" value="no">
                                    <label class="form-check-label fw-bold text-danger" for="consent_no">
                                        <i class="fas fa-times me-2"></i>☑ I Do Not Consent
                                    </label>
                                    <div class="ms-4 mt-1">
                                        <small class="text-muted">I do not authorize account creation.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-light border-start border-5 border-info">
                            <small class="text-muted">
                                <strong>Legal Certification:</strong> By selecting "I Consent" above, I certify that I am the parent or legal guardian of 
                                <strong>{{ player.full_name }}</strong> and I give my consent for Ready 2 Dink to collect, use, and disclose my child's 
                                personal information as described above and in accordance with Ready 2 Dink's Privacy Policy and Terms of Service.
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Digital Signature Section -->
                <div class="card mb-4" style="border-left: 4px solid #6f42c1;">
                    <div class="card-header bg-secondary bg-opacity-25">
                        <h6 class="mb-0"><i class="fas fa-signature me-2"></i><strong>Parent/Guardian Signature</strong></h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <label for="digital_signature" class="form-label">Digital Signature: *</label>
                                <input type="text" class="form-control" id="digital_signature" name="digital_signature" 
                                       placeholder="Type your full name as your digital signature" required>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    By typing your name here, you are providing your legal digital signature
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Date:</label>
                                <input type="text" class="form-control" id="signature_date" readonly>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <a href="/" class="btn btn-secondary me-md-2">
                        <i class="fas fa-times me-1"></i>Cancel
                    </a>
                    <button type="submit" class="btn btn-success btn-lg" id="submitBtn" disabled>
                        <i class="fas fa-shield-alt me-1"></i>Submit Authorization
                    </button>
                </div>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body text-center">
                <h6><i class="fas fa-envelope me-2"></i>Questions or Concerns?</h6>
                <p class="mb-2">Contact our support team at <a href="mailto:support@ready2dink.com">support@ready2dink.com</a></p>
                <p class="text-muted small mb-0">
                    Ready 2 Dink is committed to protecting children's privacy and complying with all applicable laws.<br>
                    This form complies with the Children's Online Privacy Protection Act (COPPA)
                </p>
            </div>
        </div>
    </div>
</div>

<script>
// Set current date
document.getElementById('signature_date').value = new Date().toLocaleDateString();

// Enable submit button only when consent is given
document.querySelectorAll('input[name="consent_given"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const submitBtn = document.getElementById('submitBtn');
        const digitalSignature = document.getElementById('digital_signature');
        
        if (this.value === 'yes') {
            submitBtn.disabled = false;
            submitBtn.className = 'btn btn-success btn-lg';
            submitBtn.innerHTML = '<i class="fas fa-shield-alt me-1"></i>Submit Authorization & Activate Account';
        } else {
            submitBtn.disabled = false;
            submitBtn.className = 'btn btn-danger btn-lg';
            submitBtn.innerHTML = '<i class="fas fa-times me-1"></i>Submit - Do Not Authorize';
        }
    });
});

// Prevent submission if no consent choice is made
document.getElementById('consentForm').addEventListener('submit', function(e) {
    const consentChoice = document.querySelector('input[name="consent_given"]:checked');
    if (!consentChoice) {
        e.preventDefault();
        alert('Please select whether you consent or do not consent to your child using Ready 2 Dink.');
        return false;
    }
    
    const digitalSignature = document.getElementById('digital_signature').value.trim();
    if (!digitalSignature) {
        e.preventDefault();
        alert('Please provide your digital signature by typing your full name.');
        return false;
    }
    
    if (consentChoice.value === 'no') {
        return confirm('You have selected "I Do Not Consent." This will prevent your child from creating a Ready 2 Dink account. Are you sure?');
    }
    
    return confirm('By submitting this form, you are providing legal consent for your child to use Ready 2 Dink. Continue?');
});
</script>
{% endblock %}